(()=>{"use strict";const t=async t=>{const e=await fetch(t);if(!e.ok)throw new Error(`Ошибка по адресу ${t} , статус ошибки ${e.status}`);return await e.json()},e=(t,e)=>{e.innerHTML="";for(let n=0;n<t.length;n++){let o=document.createElement("tr");o.className="table__row",o.innerHTML=`\n                <td class="table__id table__cell">${t[n].id}</td>\n                <td class="table-type table__cell">\n                  ${t[n].type}\n                </td>\n                <td class="table-name table__cell">\n                  ${t[n].name}\n                </td>\n                <td class="table-units table__cell">${t[n].units}</td>\n                <td class="table-cost table__cell">${t[n].cost} руб</td>\n                <td>\n                  <div class="table__actions table__cell">\n                    <button class="button action-change">\n                      <span class="svg_ui"\n                        ><svg class="action-icon_change">\n                          <use\n                            xlink:href="./img/sprite.svg#change"\n                          ></use></svg></span\n                      ><span>Изменить</span>\n                    </button>\n                    <button class="button action-remove">\n                      <span class="svg_ui"\n                        ><svg class="action-icon_remove">\n                          <use\n                            xlink:href="./img/sprite.svg#remove"\n                          ></use></svg></span\n                      ><span>Удалить</span>\n                    </button>\n                  </div>\n                </td>\n      `,e.appendChild(o)}};(()=>{if("/admin/index.html"==window.location.pathname){const t=document.getElementById("name");document.getElementById("type"),t.addEventListener("input",(()=>{t.value=t.value.replace(/[\W\s]+/gi,"")}))}})(),(()=>{const e=document.querySelector("form"),n=document.getElementById("name"),o=document.getElementById("type"),a=document.querySelector(".text-warning");try{if(!e)throw new Error("Верните форму на место пожалуйста");e.addEventListener("submit",(e=>{e.preventDefault(),t(`http://localhost:3000/users?login=${n.value}&password=${o.value}`).then((t=>{n.value="",o.value="",t.length<=0?a.textContent="Не верый логин или пароль":((t=>{delete t[0].password,t&&(document.cookie="user="+JSON.stringify(t)+"; max-age=3600")})(t),window.location.href="table.html")})).catch((t=>{console.log(t)}))}))}catch(t){console.log("ошибка")}})(),(()=>{if("/admin/index.html"==window.location.pathname)return;if(document.cookie.length<1&&"/admin/index.html"!==window.location.pathname)return void(window.location.href="index.html");let e=function(t){let e=document.cookie.match(new RegExp("(?:^|; )"+"user".replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0}();const n=JSON.parse(e);t(`http://localhost:3000/users?login=${n[0].login}&salt=${n[0].salt}`).then((t=>{t.length>0||(((t,e,n={})=>{(n={path:"/admin"}).expires instanceof Date&&(n.expires=n.expires.toUTCString());let o=encodeURIComponent(t)+"="+encodeURIComponent(e);for(let t in n){o+="; "+t;let e=n[t];!0!==e&&(o+="="+e)}document.cookie=o})("user","",{"max-age":-1}),window.location.href="index.html")}))})(),(()=>{if("/admin/table.html"!==window.location.pathname)return;const n=document.getElementById("typeItem"),o=document.getElementById("tbody"),a=document.getElementById("modal"),l=document.querySelector(".btn-addItem"),s=a.querySelector("form"),c=document.querySelector(".modal__header");o.innerHTML="",n.innerHTML="";const r=()=>{t("http://localhost:3000/items").then((t=>{e(t,o),((t,e,n)=>{n.innerHTML="";let o=[];t.forEach(((t,e)=>{o[e]=t.type})),Array.from(new Set(o)).forEach((t=>{if(t){const e=document.createElement("option");e.value=t,e.textContent=t,n.append(e)}}));const a=document.createElement("option");a.value="Все услуги",a.textContent="Все услуги",a.setAttribute("selected",""),n.append(a)})(t,0,n)})).catch((t=>{console.log(t)}))};n.addEventListener("change",(a=>{const l=n.options[n.selectedIndex].textContent.trim();"Все услуги"===l?t("http://localhost:3000/items").then((t=>{e(t,o)})):t(`http://localhost:3000/items?type=${l}`).then((t=>{e(t,o)}))})),l.addEventListener("click",(t=>{c.textContent="Добавление новой услуги",a.style.display="flex",t.preventDefault()})),a.addEventListener("click",(t=>{t.preventDefault(),(!t.target.closest(".modal")||t.target.closest(".svg_ui")||t.target.closest(".cancel-button"))&&(a.querySelectorAll("input").forEach((t=>{t.value=""})),a.style.display="none")}));let i="";document.addEventListener("click",(t=>{if(t.target.closest(".action-change")){c.textContent="Редактировать услугу",a.style.display="flex";const e=s.querySelectorAll("input"),n=t.target.closest(".table__row"),o=n.querySelector(".table__id");e.forEach((t=>{const e=n.querySelector(`.table-${t.name}`);"cost"==t.name?t.value=e.textContent.trim().replace(/[^+\d]/g,""):t.value=e.textContent.trim()})),i=o.textContent}if(t.target.closest(".button-ui_firm")&&(t.preventDefault(),(t=>{const e=a.querySelector("form"),n=s.querySelectorAll("input"),o={},l=new FormData(e);l?(l.forEach(((t,e)=>{o[e]=t})),t?(async(t,e)=>{if(t.length<1)return;const n=await fetch(`http://localhost:3000/items/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Ошибка по адресу http://localhost:3000/items/${e} , статус ошибки ${n.status}`);return await n.json()})(o,t).then((t=>{n.forEach((t=>{t.value=""})),r()})):(o.id=Date.now(),(async(t,e)=>{if(e.length<1)return;const n=await fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Ошибка по адресу ${t} , статус ошибки ${n.status}`);return await n.json()})("http://localhost:3000/items",o).then((t=>{n.forEach((t=>{t.value=""})),r()})))):a.style.display="none"})(i)),t.target.closest(".action-remove")){t.preventDefault();const e=s.querySelectorAll("input"),n=t.target.closest(".table__row").querySelector(".table__id");i=n.textContent,console.log(i),(async t=>{const e=await fetch(`http://localhost:3000/items/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Ошибка по адресу http://localhost:3000/items/${t} , статус ошибки ${e.status}`);return await e.json()})(i).then((t=>{e.forEach((t=>{t.value=""})),r()}))}})),r()})()})();